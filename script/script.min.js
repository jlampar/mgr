"use strict";!function(e,t){e.addEventListener("DOMContentLoaded",function(){var n=t.location.href.replace(t.location.hash,"");[].slice.call(e.querySelectorAll("use[*|href]")).filter(function(e){return 0===e.getAttribute("xlink:href").indexOf("#")}).forEach(function(e){e.setAttribute("xlink:href",n+e.getAttribute("xlink:href"))})},!1)}(document,window),$(document).ready(function(){function e(t){var n;if(t instanceof Array){n=[];for(var o=0,a=t.length;a>o;o++)n[o]=e(t[o]);return n}return t}function t(e){if(document.getElementById(e)){for(var t=document.getElementById(e).getAttribute("d"),n='"'+(t+"")+'"',o=n.replace(/[MZ]/g,"").replace(/[L]/g," ").split(" "),a=[],i=0;i<xArray.length;i++)a.push([parseFloat(o[r].replace(/["]/g,"")[c].split(",")[0][i]),parseFloat(o[r].replace(/["]/g,"")[c].split(",")[1][i])]);return a}}function n(n,o){if(document.getElementById(n)&&document.getElementById(o)){enterPath=t(n),exitPath=t(o);for(var a,r,i=e(enterPath),l=e(exitPath),d=[],c=0;c<l.length;c++)numerator=l.splice(c,exitPath.length-c),l=numerator.concat(l),a=Math.abs(i[c][0]-l[c][0]),r=Math.abs(i[c][1]-l[c][1]),d.push(Math.sqrt(a*a+r*r)),l.length=0,l=e(exitPath),numerator=null;return d.indexOf(Math.min.apply(null,d))}}function o(e,t){if(document.getElementById(e)&&document.getElementById(t)){enID=document.getElementById(e),exID=document.getElementById(t);var o=KUTE.fromTo(enID,{path:enID},{path:exID},{morphPrecision:1,morphIndex:n(enID,exID),easing:"easingElasticInOut",duration:500});return o}}function a(e,t,n){var a=n?y[t]!==e?y.map(function(e,n){return n===t?e+1:e}):y:0!==y[t]?y.map(function(e,n){return n===t?e-1:e}):y,r=a.join("");if(y=a,console.log("0000 ---> ",a),document.getElementById("0000")&&document.getElementById(r)){document.getElementById("tdBase").innerHTML=f.based[y[0]],document.getElementById("tdGene").innerHTML=f.gene[y[1]],document.getElementById("tdNet").innerHTML=f.net[y[2]],document.getElementById("tdGauss").innerHTML=f.kernel[y[3]];for(var i=[],l=[],d=[],c=[],s=[],u=0;u<document.getElementById("0000").childNodes.length;u++)i.push(document.getElementById("0000").childNodes[u].id),l.push(document.getElementById(r).childNodes[u].id);for(var p=0;p<i.length;p++)d.push([i[p],l[p]]);for(var m=0;m<d.length;m++)c.push(o(d[m][0],d[m][1]));for(var g=0;g<c.length;g++)s.push(c[g].start());return s}}var i=document.getElementById("basket").offsetHeight,l=i,d=d3.select(document.getElementById("basket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+l+" "+i).attr("id","SVG"),c=(d3.select("#basket"),d.append("g").attr("id","container")),s=d3.geoMercator(),u=["0000","0001","0002","0003","0004","0005","0006","0007","0008","0009","0010","0011","0012","0013","0014","0015","0016","0017","0018","0019","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0111","0112","0113","0114","0115","0116","0117","0118","0119","0200","0201","0202","0203","0204","0205","0206","0207","0208","0209","0210","0211","0212","0213","0214","0215","0216","0217","0218","0219","0300","0301","0302","0303","0304","0305","0306","0307","0308","0309","0310","0311","0312","0313","0314","0315","0316","0317","0318","0319","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1100","1101","1102","1103","1104","1105","1106","1107","1108","1109","1110","1111","1112","1113","1114","1115","1116","1117","1118","1119","1200","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1300","1301","1302","1303","1304","1305","1306","1307","1308","1309","1310","1311","1312","1313","1314","1315","1316","1317","1318","1319","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2100","2101","2102","2103","2104","2105","2106","2107","2108","2109","2110","2111","2112","2113","2114","2115","2116","2117","2118","2119","2200","2201","2202","2203","2204","2205","2206","2207","2208","2209","2210","2211","2212","2213","2214","2215","2216","2217","2218","2219","2300","2301","2302","2303","2304","2305","2306","2307","2308","2309","2310","2311","2312","2313","2314","2315","2316","2317","2318","2319"],p=[];domainAbsolute=[34e3,53e3,111e3,168e3,203e3,497e3,1416412],domainRelative=[2,3.3,5.2,6.4,8.8,12.5,24.76],colorRange=["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"];var m=d3.scaleThreshold().domain(domainAbsolute).range(colorRange),g=d3.scaleThreshold().domain(domainRelative).range(colorRange),h=d3.queue();u.forEach(function(e){var t="https://rawgit.com/jlampar/mgr/master/data/JSON/c"+e+".min.topojson";h.defer(d3.json,t),p.push(e)}),h.defer(d3.csv,"https://rawgit.com/jlampar/mgr/master/data/choropeth_data.csv"),h.awaitAll(function(e,t){if(e)throw e;var n={},o={},a={},r={},d={},h=t[t.length-1];h.forEach(function(e){n[e.woj]=+e.widz,o[e.woj]=+e.wzgwidz,a[e.woj]=+e.area});var f=p.indexOf("2019"),y=topojson.feature(t[f],Object.values(t[f].objects)[0]);p.length=0,s.scale(1).translate([0,0]);var v=d3.geoPath().projection(s),B=v.bounds(y),I=.95/Math.max((B[1][0]-B[0][0])/l,(B[1][1]-B[0][1])/i),w=[(l-I*(B[1][0]+B[0][0]))/2,(i-I*(B[1][1]+B[0][1]))/2];s.scale(I).translate(w);for(var E=0;E<t.length-1;E++){r[u[E]]=Object.values(t[E+""].objects)[0].geometries;var b=d3.geoPath().projection(s),x=topojson.feature(t[E],Object.values(t[E].objects)[0]);0===E?c.append("g").attr("id",u[E]).selectAll("path").data(x.features).enter().append("path").attr("id",function(e){return e.properties.woj+u[E]}).attr("d",b).style("fill",function(e){return m(n[e.properties.woj])}).style("stroke","black").style("stroke-width","0.05em"):c.append("g").attr("id",u[E]).attr("class","hide").selectAll("path").data(x.features).enter().append("path").attr("id",function(e){return e.properties.woj+u[E]}).attr("d",b)}for(var k in r){for(var j=Object.values(r[k]),M=[],A=0;A<j.length;A++)M.push(r[k][A].properties.Shape_Area);d[k]=M}console.log(r),console.log(d);var $=60,T=$,L=d3.select(document.getElementById("relativeBasket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+T+" "+$).attr("id","rSVG"),O=(d3.select("#relativeBasket"),topojson.feature(t[0],Object.values(t[0].objects)[0]));s.scale(1).translate([0,0]);var P=d3.geoPath().projection(s),G=P.bounds(O),R=.95/Math.max((G[1][0]-G[0][0])/T,(G[1][1]-G[0][1])/$),H=[(T-R*(G[1][0]+G[0][0]))/2,($-R*(G[1][1]+G[0][1]))/2];s.scale(R).translate(H);var D=d3.geoPath().projection(s);L.append("g").attr("id","relCont").selectAll("path").data(O.features).enter().append("path").attr("id",function(e){return e.properties.woj}).attr("d",D).style("fill",function(e){return g(o[e.properties.woj])}).style("stroke","black").style("stroke-width","0.01em");for(var N=d3.format(".1f"),S=0;S<colorRange.length;S++){var z="leg"+S;d3.select(document.getElementById("legendBasket")).append("div").style("display","block").attr("id",z);var C=d3.select(document.getElementById(z));C.append("div").text(N(domainRelative[S])).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","right").style("margin-right","1em"),C.append("div").style("background-color",colorRange[S]).style("width","30px").style("height","10px").style("display","inline-block"),C.append("div").text(domainAbsolute[S]).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","left").style("margin-left","1em")}});var f={based:["wojewÃ³dztwa","powiaty","gminy"],gene:["500","1000","2000","4000"],net:["256","512"],kernel:["151","81","61","41","21","11","7","5","3","1"]},y=[0,0,0,0];document.getElementById("tdBase").innerHTML=f.based[y[0]],document.getElementById("tdGene").innerHTML=f.gene[y[1]],document.getElementById("tdNet").innerHTML=f.net[y[2]],document.getElementById("tdGauss").innerHTML=f.kernel[y[3]],document.getElementById("nBase").onclick=function(){a(2,0,!0)},document.getElementById("pBase").onclick=function(){a(2,0,!1)},document.getElementById("nGene").onclick=function(){a(3,1,!0)},document.getElementById("pGene").onclick=function(){a(3,1,!1)},document.getElementById("nNet").onclick=function(){a(1,2,!0)},document.getElementById("pNet").onclick=function(){a(1,2,!1)},document.getElementById("nGauss").onclick=function(){a(9,3,!0)},document.getElementById("pGauss").onclick=function(){a(9,3,!1)};var v=$("#cont"),B=$("#header"),I=$("#paraStory"),w=$("#first"),E=$("#second"),b=$("#third");$(window).on("scroll",function(){var e=$(this).scrollTop();v.css({opacity:1-e/200}),B.css({opacity:1-e/130}),I.css({opacity:0+e/350}),w.css({opacity:0+e/450}),E.css({opacity:0+e/470}),b.css({opacity:0+e/490})}),$(window).on("resize",function(){$(window).width()>961||(I.css({opacity:"1"}),w.css({opacity:"1"}),E.css({opacity:"1"}),b.css({opacity:"1"}))}),$(".boxFrame").hover(function(){$(window).width()>961&&$(this).children(".icon").toggleClass("icon over")},function(){$(window).width()>961&&$(this).children(".over").toggleClass("over icon")})});
