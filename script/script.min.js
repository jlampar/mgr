"use strict";!function(e,t){e.addEventListener("DOMContentLoaded",function(){var n=t.location.href.replace(t.location.hash,"");[].slice.call(e.querySelectorAll("use[*|href]")).filter(function(e){return 0===e.getAttribute("xlink:href").indexOf("#")}).forEach(function(e){e.setAttribute("xlink:href",n+e.getAttribute("xlink:href"))})},!1)}(document,window),$(document).ready(function(){var e={files:["0000","0001","0002","0003","0004","0005","0006","0007","0008","0009","0010","0011","0012","0013","0014","0015","0016","0017","0018","0019","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0111","0112","0113","0114","0115","0116","0117","0118","0119","0200","0201","0202","0203","0204","0205","0206","0207","0208","0209","0210","0211","0212","0213","0214","0215","0216","0217","0218","0219","0300","0301","0302","0303","0304","0305","0306","0307","0308","0309","0310","0311","0312","0313","0314","0315","0316","0317","0318","0319","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1100","1101","1102","1103","1104","1105","1106","1107","1108","1109","1110","1111","1112","1113","1114","1115","1116","1117","1118","1119","1200","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1300","1301","1302","1303","1304","1305","1306","1307","1308","1309","1310","1311","1312","1313","1314","1315","1316","1317","1318","1319","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2100","2101","2102","2103","2104","2105","2106","2107","2108","2109","2110","2111","2112","2113","2114","2115","2116","2117","2118","2119","2200","2201","2202","2203","2204","2205","2206","2207","2208","2209","2210","2211","2212","2213","2214","2215","2216","2217","2218","2219","2300","2301","2302","2303","2304","2305","2306","2307","2308","2309","2310","2311","2312","2313","2314","2315","2316","2317","2318","2319"],colors:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],breaksAbsolute:[33852,52710,110498,167292,202605,496489,1416412],breaksRelative:[2.09,3.26,5.14,6.35,8.71,12.49,24.76]},t=document.getElementById("basket").offsetHeight,n=t,a=d3.select(document.getElementById("basket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+t).attr("id","SVG"),r=(d3.select("#basket"),a.append("g").attr("id","container")),i=d3.geoMercator(),l=[],o=d3.scaleThreshold().domain(e.breaksAbsolute).range(e.colors),s=d3.scaleThreshold().domain(e.breaksRelative).range(e.colors),d=d3.queue();e.files.forEach(function(e){var t="master/data/JSON/c"+e+".min.topojson";d.defer(d3.json,t),l.push(e)}),d.defer(d3.csv,"master/data/choropeth_data.csv"),d.awaitAll(function(a,d){if(a)throw a;var c={},p={},u={},g={},h={};d[d.length-1].forEach(function(e){c[e.woj]=+e.widz,p[e.woj]=+e.wzgwidz,u[e.woj]=+e.area});var m=l.indexOf("2019");var y=topojson.feature(d[m],Object.values(d[m].objects)[0]);l.length=0,i.scale(1).translate([0,0]);var f=d3.geoPath().projection(i).bounds(y),v=.95/Math.max((f[1][0]-f[0][0])/n,(f[1][1]-f[0][1])/t),b=[(n-v*(f[1][0]+f[0][0]))/2,(t-v*(f[1][1]+f[0][1]))/2];i.scale(v).translate(b);for(var w=0;w<d.length-1;w++){g[e.files[w]]=Object.values(d[String(w)].objects)[0].geometries;var k=d3.geoPath().projection(i),B=topojson.feature(d[w],Object.values(d[w].objects)[0]);0===w?r.append("g").attr("id",e.files[w]).selectAll("path").data(B.features).enter().append("path").attr("id",function(t){return t.properties.woj+e.files[w]}).attr("d",k).style("fill",function(e){return o(c[e.properties.woj])}).style("stroke","black").style("stroke-width","0.05em"):r.append("g").attr("id",e.files[w]).attr("class","hide").selectAll("path").data(B.features).enter().append("path").attr("id",function(t){return t.properties.woj+e.files[w]}).attr("d",k)}for(var x in g){var I=Object.values(g[x]),E=[];for(var j=0;j<I.length;j++)E.push(g[x][j].properties.Shape_Area);h[x]=E}var A=60,M=A,$=d3.select(document.getElementById("relativeBasket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+M+" "+A).attr("id","rSVG"),S=(d3.select("#relativeBasket"),topojson.feature(d[0],Object.values(d[0].objects)[0]));i.scale(1).translate([0,0]);var T=d3.geoPath().projection(i).bounds(S),z=.95/Math.max((T[1][0]-T[0][0])/M,(T[1][1]-T[0][1])/A),L=[(M-z*(T[1][0]+T[0][0]))/2,(A-z*(T[1][1]+T[0][1]))/2];i.scale(z).translate(L);var O=d3.geoPath().projection(i);$.append("g").attr("id","relCont").selectAll("path").data(S.features).enter().append("path").attr("id",function(e){return e.properties.woj}).attr("d",O).style("fill",function(e){return s(p[e.properties.woj])}).style("stroke","black").style("stroke-width","0.01em"),d3.select(document.getElementById("legendBasket")).append("div").style("display","block").attr("id","labels");var P=d3.select(document.getElementById("labels"));P.append("div").text("Odsetek widzów [%]").style("display","inline-block").style("width","100px").style("height","7px").style("text-align","right").style("margin-right","1em").style("font-size","9px"),P.append("div").style("width","30px").style("height","10px").style("display","inline-block"),P.append("div").text("Liczba widzów").style("display","inline-block").style("width","100px").style("height","7px").style("text-align","left").style("margin-left","1em").style("font-size","9px");var G=d3.format(".2f");for(var H=e.colors.length-1;H>=0;H--){var D="leg"+H;d3.select(document.getElementById("legendBasket")).append("div").style("display","block").attr("id",D);var N=d3.select(document.getElementById(D));N.append("div").text(H==e.colors.length-1?"powyżej "+String(G(e.breaksRelative[H-1])):0==H?"poniżej "+String(G(e.breaksRelative[H+1])):G(e.breaksRelative[H-1])+" - "+G(e.breaksRelative[H])).style("display","inline-block").style("width","100px").style("height","7px").style("text-align","right").style("margin-right","1em").style("font-size","9px"),N.append("div").style("background-color",e.colors[H]).style("width","30px").style("height","10px").style("display","inline-block"),N.append("div").text(H==e.colors.length-1?"powyżej "+String(e.breaksAbsolute[H-1]):0==H?"poniżej "+String(e.breaksAbsolute[H+1]):String(e.breaksAbsolute[H-1])+" - "+String(e.breaksAbsolute[H])).style("display","inline-block").style("width","100px").style("height","7px").style("text-align","left").style("margin-left","1em").style("font-size","9px")}});var c={based:["województwa","powiaty","gminy"],gene:["500","1000","2000","4000"],net:["256","512"],kernel:["151","81","61","41","21","11","7","5","3","1"]};var p=null;var u=[0,0,0,0];document.getElementById("tdBase").innerHTML=c.based[u[0]],document.getElementById("tdGene").innerHTML=c.gene[u[1]],document.getElementById("tdNet").innerHTML=c.net[u[2]],document.getElementById("tdGauss").innerHTML=c.kernel[u[3]],document.getElementById("nBase").onclick=function(){x(2,0,!0)},document.getElementById("pBase").onclick=function(){x(2,0,!1)},document.getElementById("nGene").onclick=function(){x(3,1,!0)},document.getElementById("pGene").onclick=function(){x(3,1,!1)},document.getElementById("nNet").onclick=function(){x(1,2,!0)},document.getElementById("pNet").onclick=function(){x(1,2,!1)},document.getElementById("nGauss").onclick=function(){x(9,3,!0)},document.getElementById("pGauss").onclick=function(){x(9,3,!1)};var g=$("#cont"),h=$("#header"),m=$("#paraStory"),y=$("#first"),f=$("#second"),v=$("#third");$(window).on("scroll",function(){var e=$(this).scrollTop();g.css({opacity:1-e/200}),h.css({opacity:1-e/130}),m.css({opacity:0+e/350}),y.css({opacity:0+e/450}),f.css({opacity:0+e/470}),v.css({opacity:0+e/490})}),$(window).on("resize",function(){$(window).width()<=961&&(m.css({opacity:"1"}),y.css({opacity:"1"}),f.css({opacity:"1"}),v.css({opacity:"1"}))}),$(".boxFrame").hover(function(){$(window).width()>961&&$(this).children(".icon").toggleClass("icon over")},function(){$(window).width()>961&&$(this).children(".over").toggleClass("over icon")});function b(e){var t;if(e instanceof Array){t=[];for(var n=0,a=e.length;n<a;n++)t[n]=b(e[n]);return t}return e}function w(e){if(document.getElementById(e)){var t=document.getElementById(e).getAttribute("d"),n=('"'+String(t)+'"').replace(/[MZ]/g,"").replace(/[L]/g," ").split(" "),a=[];for(var r=0;r<n.length;r++)a.push([parseFloat(n.replace(/["]/g,"").split(",")[0][r]),parseFloat(n.replace(/["]/g,"").split(",")[1][r])]);return a}}function k(e,t){if(document.getElementById(e)&&document.getElementById(t)){enterPath=w(e),exitPath=w(t);var n,a,r=b(enterPath),i=b(exitPath),l=[];for(var o=0;o<i.length;o++)idArray=i.splice(o,exitPath.length-o),i=idArray.concat(i),n=Math.abs(r[o][0]-i[o][0]),a=Math.abs(r[o][1]-i[o][1]),l.push(Math.sqrt(n*n+a*a)),i.length=0,i=b(exitPath),idArray=null;return l.indexOf(Math.min.apply(null,l))}}function B(e,t){if(document.getElementById(e)&&document.getElementById(t)){var enterID=document.getElementById(e),exitID=document.getElementById(t);return KUTE.fromTo(enterID,{path:enterID},{path:exitID},{morphPrecision:1,morphIndex:k(enterID,exitID),easing:"easingElasticInOut",duration:500})}}function x(e,t,n){var a=n?u[t]!==e?u.map(function(e,n){return n===t?e+1:e}):u:0!==u[t]?u.map(function(e,n){return n===t?e-1:e}):u;var r=a.join("");if(p=u,u=a,document.getElementById("0000")&&document.getElementById(r)&&p.join("")!==r){document.getElementById("tdBase").innerHTML=c.based[u[0]],document.getElementById("tdGene").innerHTML=c.gene[u[1]],document.getElementById("tdNet").innerHTML=c.net[u[2]],document.getElementById("tdGauss").innerHTML=c.kernel[u[3]];var i=[],l=[],o=[],s=[],d=[];for(var g=0;g<document.getElementById("0000").childNodes.length;g++)i.push(document.getElementById("0000").childNodes[g].id),l.push(document.getElementById(r).childNodes[g].id);for(var h=0;h<i.length;h++)o.push([i[h],l[h]]);for(var m=0;m<o.length;m++)s.push(B(o[m][0],o[m][1]));for(var y=0;y<s.length;y++)d.push(s[y].start());return d}}});
