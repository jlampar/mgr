"use strict";!function(e,t){e.addEventListener("DOMContentLoaded",function(){var n=t.location.href.replace(t.location.hash,"");[].slice.call(e.querySelectorAll("use[*|href]")).filter(function(e){return 0===e.getAttribute("xlink:href").indexOf("#")}).forEach(function(e){e.setAttribute("xlink:href",n+e.getAttribute("xlink:href"))})},!1)}(document,window),$(document).ready(function(){var e={files:["0000","0001","0002","0003","0004","0005","0006","0007","0008","0009","0010","0011","0012","0013","0014","0015","0016","0017","0018","0019","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0111","0112","0113","0114","0115","0116","0117","0118","0119","0200","0201","0202","0203","0204","0205","0206","0207","0208","0209","0210","0211","0212","0213","0214","0215","0216","0217","0218","0219","0300","0301","0302","0303","0304","0305","0306","0307","0308","0309","0310","0311","0312","0313","0314","0315","0316","0317","0318","0319","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1100","1101","1102","1103","1104","1105","1106","1107","1108","1109","1110","1111","1112","1113","1114","1115","1116","1117","1118","1119","1200","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1300","1301","1302","1303","1304","1305","1306","1307","1308","1309","1310","1311","1312","1313","1314","1315","1316","1317","1318","1319","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2100","2101","2102","2103","2104","2105","2106","2107","2108","2109","2110","2111","2112","2113","2114","2115","2116","2117","2118","2119","2200","2201","2202","2203","2204","2205","2206","2207","2208","2209","2210","2211","2212","2213","2214","2215","2216","2217","2218","2219","2300","2301","2302","2303","2304","2305","2306","2307","2308","2309","2310","2311","2312","2313","2314","2315","2316","2317","2318","2319"],colors:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],breaksAbsolute:[34e3,53e3,111e3,168e3,203e3,497e3,1416412],breaksRelative:[2,3.3,5.2,6.4,8.8,12.5,24.76]},t=document.getElementById("basket").offsetHeight,n=t,a=d3.select(document.getElementById("basket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+t).attr("id","SVG"),r=(d3.select("#basket"),a.append("g").attr("id","container")),o=d3.geoMercator(),i=[],l=d3.scaleThreshold().domain(e.breaksAbsolute).range(e.colors),s=d3.scaleThreshold().domain(e.breaksRelative).range(e.colors),d=d3.queue();e.files.forEach(function(e){var t="https://rawgit.com/jlampar/mgr/master/data/JSON/c"+e+".min.topojson";d.defer(d3.json,t),i.push(e)}),d.defer(d3.csv,"https://rawgit.com/jlampar/mgr/master/data/choropeth_data.csv"),d.awaitAll(function(a,d){if(a)throw a;var c={},u={},p={},m={},g={};d[d.length-1].forEach(function(e){c[e.woj]=+e.widz,u[e.woj]=+e.wzgwidz,p[e.woj]=+e.area});var h=i.indexOf("2019");var f=topojson.feature(d[h],Object.values(d[h].objects)[0]);i.length=0,o.scale(1).translate([0,0]);var y=d3.geoPath().projection(o).bounds(f),v=.95/Math.max((y[1][0]-y[0][0])/n,(y[1][1]-y[0][1])/t),b=[(n-v*(y[1][0]+y[0][0]))/2,(t-v*(y[1][1]+y[0][1]))/2];o.scale(v).translate(b);for(var B=0;B<d.length-1;B++){m[e.files[B]]=Object.values(d[String(B)].objects)[0].geometries;var I=d3.geoPath().projection(o),w=topojson.feature(d[B],Object.values(d[B].objects)[0]);0===B?r.append("g").attr("id",e.files[B]).selectAll("path").data(w.features).enter().append("path").attr("id",function(t){return t.properties.woj+e.files[B]}).attr("d",I).style("fill",function(e){return l(c[e.properties.woj])}).style("stroke","black").style("stroke-width","0.05em"):r.append("g").attr("id",e.files[B]).attr("class","hide").selectAll("path").data(w.features).enter().append("path").attr("id",function(t){return t.properties.woj+e.files[B]}).attr("d",I)}for(var E in m){var k=Object.values(m[E]),x=[];for(var j=0;j<k.length;j++)x.push(m[E][j].properties.Shape_Area);g[E]=x}var M=60,A=M,$=d3.select(document.getElementById("relativeBasket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+A+" "+M).attr("id","rSVG"),T=(d3.select("#relativeBasket"),topojson.feature(d[0],Object.values(d[0].objects)[0]));o.scale(1).translate([0,0]);var L=d3.geoPath().projection(o).bounds(T),O=.95/Math.max((L[1][0]-L[0][0])/A,(L[1][1]-L[0][1])/M),P=[(A-O*(L[1][0]+L[0][0]))/2,(M-O*(L[1][1]+L[0][1]))/2];o.scale(O).translate(P);var G=d3.geoPath().projection(o);$.append("g").attr("id","relCont").selectAll("path").data(T.features).enter().append("path").attr("id",function(e){return e.properties.woj}).attr("d",G).style("fill",function(e){return s(u[e.properties.woj])}).style("stroke","black").style("stroke-width","0.01em");var H=d3.format(".1f");for(var D=e.colors.length-1;D>=0;D--){var N="leg"+D;d3.select(document.getElementById("legendBasket")).append("div").style("display","block").attr("id",N);var S=d3.select(document.getElementById(N));S.append("div").text(H(e.breaksRelative[D])).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","right").style("margin-right","1em"),S.append("div").style("background-color",e.colors[D]).style("width","30px").style("height","10px").style("display","inline-block"),S.append("div").text(e.breaksAbsolute[D]).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","left").style("margin-left","1em")}});var c={based:["wojew√≥dztwa","powiaty","gminy"],gene:["500","1000","2000","4000"],net:["256","512"],kernel:["151","81","61","41","21","11","7","5","3","1"]};var u=[0,0,0,0];document.getElementById("tdBase").innerHTML=c.based[u[0]],document.getElementById("tdGene").innerHTML=c.gene[u[1]],document.getElementById("tdNet").innerHTML=c.net[u[2]],document.getElementById("tdGauss").innerHTML=c.kernel[u[3]],document.getElementById("nBase").onclick=function(){w(2,0,!0)},document.getElementById("pBase").onclick=function(){w(2,0,!1)},document.getElementById("nGene").onclick=function(){w(3,1,!0)},document.getElementById("pGene").onclick=function(){w(3,1,!1)},document.getElementById("nNet").onclick=function(){w(1,2,!0)},document.getElementById("pNet").onclick=function(){w(1,2,!1)},document.getElementById("nGauss").onclick=function(){w(9,3,!0)},document.getElementById("pGauss").onclick=function(){w(9,3,!1)};var p=$("#cont"),m=$("#header"),g=$("#paraStory"),h=$("#first"),f=$("#second"),y=$("#third");$(window).on("scroll",function(){var e=$(this).scrollTop();p.css({opacity:1-e/200}),m.css({opacity:1-e/130}),g.css({opacity:0+e/350}),h.css({opacity:0+e/450}),f.css({opacity:0+e/470}),y.css({opacity:0+e/490})}),$(window).on("resize",function(){$(window).width()<=961&&(g.css({opacity:"1"}),h.css({opacity:"1"}),f.css({opacity:"1"}),y.css({opacity:"1"}))}),$(".boxFrame").hover(function(){$(window).width()>961&&$(this).children(".icon").toggleClass("icon over")},function(){$(window).width()>961&&$(this).children(".over").toggleClass("over icon")});function v(e){var t;if(e instanceof Array){t=[];for(var n=0,a=e.length;n<a;n++)t[n]=v(e[n]);return t}return e}function b(e){if(document.getElementById(e)){var t=document.getElementById(e).getAttribute("d"),n=('"'+String(t)+'"').replace(/[MZ]/g,"").replace(/[L]/g," ").split(" "),a=[];for(var r=0;r<n.length;r++)a.push([parseFloat(n.replace(/["]/g,"").split(",")[0][r]),parseFloat(n.replace(/["]/g,"").split(",")[1][r])]);return a}}function B(e,t){if(document.getElementById(e)&&document.getElementById(t)){enterPath=b(e),exitPath=b(t);var n,a,r=v(enterPath),o=v(exitPath),i=[];for(var l=0;l<o.length;l++)idArray=o.splice(l,exitPath.length-l),o=idArray.concat(o),n=Math.abs(r[l][0]-o[l][0]),a=Math.abs(r[l][1]-o[l][1]),i.push(Math.sqrt(n*n+a*a)),o.length=0,o=v(exitPath),idArray=null;return i.indexOf(Math.min.apply(null,i))}}function I(e,t){if(document.getElementById(e)&&document.getElementById(t))var enterID=document.getElementById(e),exitID=document.getElementById(t);return KUTE.fromTo(enterID,{path:enterID},{path:exitID},{morphPrecision:1,morphIndex:B(enterID,exitID),easing:"easingElasticInOut",duration:500})}function w(e,t,n){var a=n?u[t]!==e?u.map(function(e,n){return n===t?e+1:e}):u:0!==u[t]?u.map(function(e,n){return n===t?e-1:e}):u;var r=a.join("");if(u=a,document.getElementById("0000")&&document.getElementById(r)){document.getElementById("tdBase").innerHTML=c.based[u[0]],document.getElementById("tdGene").innerHTML=c.gene[u[1]],document.getElementById("tdNet").innerHTML=c.net[u[2]],document.getElementById("tdGauss").innerHTML=c.kernel[u[3]];var o=[],i=[],l=[],s=[],d=[];for(var p=0;p<document.getElementById("0000").childNodes.length;p++)o.push(document.getElementById("0000").childNodes[p].id),i.push(document.getElementById(r).childNodes[p].id);for(var m=0;m<o.length;m++)l.push([o[m],i[m]]);for(var g=0;g<l.length;g++)s.push(I(l[g][0],l[g][1]));for(var h=0;h<s.length;h++)d.push(s[h].start());return d}}});
