"use strict";!function(e,t){e.addEventListener("DOMContentLoaded",function(){var n=t.location.href.replace(t.location.hash,"");[].slice.call(e.querySelectorAll("use[*|href]")).filter(function(e){return 0===e.getAttribute("xlink:href").indexOf("#")}).forEach(function(e){e.setAttribute("xlink:href",n+e.getAttribute("xlink:href"))})},!1)}(document,window),$(document).ready(function(){function e(t){var n;if(t instanceof Array){n=[];for(var a=0,r=t.length;a<r;a++)n[a]=e(t[a]);return n}return t}function t(e){if(document.getElementById(e)){for(var t=document.getElementById(e).getAttribute("d"),n=('"'+String(t)+'"').replace(/[MZ]/g,"").replace(/[L]/g," ").split(" "),a=[],o=0;o<n.length;o++)a.push([parseFloat(n[r].replace(/["]/g,"")[c].split(",")[0][o]),parseFloat(n[r].replace(/["]/g,"")[c].split(",")[1][o])]);return a}}function n(n,a){if(document.getElementById(n)&&document.getElementById(a)){enterPath=t(n),exitPath=t(a);for(var r,o,i=e(enterPath),l=e(exitPath),s=[],d=0;d<l.length;d++)idArray=l.splice(d,exitPath.length-d),l=idArray.concat(l),r=Math.abs(i[d][0]-l[d][0]),o=Math.abs(i[d][1]-l[d][1]),s.push(Math.sqrt(r*r+o*o)),l.length=0,l=e(exitPath),idArray=null;return s.indexOf(Math.min.apply(null,s))}}function a(e,t){if(document.getElementById(e)&&document.getElementById(t))return enterID=document.getElementById(e),exitID=document.getElementById(t),KUTE.fromTo(enterID,{path:enterID},{path:exitID},{morphPrecision:1,morphIndex:n(enterID,exitID),easing:"easingElasticInOut",duration:500})}function o(e,t,n){var r=n?y[t]!==e?y.map(function(e,n){return n===t?e+1:e}):y:0!==y[t]?y.map(function(e,n){return n===t?e-1:e}):y,o=r.join("");if(y=r,document.getElementById("0000")&&document.getElementById(o)){document.getElementById("tdBase").innerHTML=f.based[y[0]],document.getElementById("tdGene").innerHTML=f.gene[y[1]],document.getElementById("tdNet").innerHTML=f.net[y[2]],document.getElementById("tdGauss").innerHTML=f.kernel[y[3]];for(var i=[],l=[],s=[],d=[],c=[],u=0;u<document.getElementById("0000").childNodes.length;u++)i.push(document.getElementById("0000").childNodes[u].id),l.push(document.getElementById(o).childNodes[u].id);for(var p=0;p<i.length;p++)s.push([i[p],l[p]]);for(var m=0;m<s.length;m++)d.push(a(s[m][0],s[m][1]));for(var g=0;g<d.length;g++)c.push(d[g].start());return c}}var i={files:["0000","0001","0002","0003","0004","0005","0006","0007","0008","0009","0010","0011","0012","0013","0014","0015","0016","0017","0018","0019","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0111","0112","0113","0114","0115","0116","0117","0118","0119","0200","0201","0202","0203","0204","0205","0206","0207","0208","0209","0210","0211","0212","0213","0214","0215","0216","0217","0218","0219","0300","0301","0302","0303","0304","0305","0306","0307","0308","0309","0310","0311","0312","0313","0314","0315","0316","0317","0318","0319","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1100","1101","1102","1103","1104","1105","1106","1107","1108","1109","1110","1111","1112","1113","1114","1115","1116","1117","1118","1119","1200","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1300","1301","1302","1303","1304","1305","1306","1307","1308","1309","1310","1311","1312","1313","1314","1315","1316","1317","1318","1319","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2100","2101","2102","2103","2104","2105","2106","2107","2108","2109","2110","2111","2112","2113","2114","2115","2116","2117","2118","2119","2200","2201","2202","2203","2204","2205","2206","2207","2208","2209","2210","2211","2212","2213","2214","2215","2216","2217","2218","2219","2300","2301","2302","2303","2304","2305","2306","2307","2308","2309","2310","2311","2312","2313","2314","2315","2316","2317","2318","2319"],colors:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],breaksAbsolute:[34e3,53e3,111e3,168e3,203e3,497e3,1416412],breaksRelative:[2,3.3,5.2,6.4,8.8,12.5,24.76]},l=document.getElementById("basket").offsetHeight,s=l,d=d3.select(document.getElementById("basket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+s+" "+l).attr("id","SVG"),c=(d3.select("#basket"),d.append("g").attr("id","container")),u=d3.geoMercator(),p=[],m=d3.scaleThreshold().domain(i.breaksAbsolute).range(i.colors),g=d3.scaleThreshold().domain(i.breaksRelative).range(i.colors),h=d3.queue();i.files.forEach(function(e){var t="https://rawgit.com/jlampar/mgr/master/data/JSON/c"+e+".min.topojson";h.defer(d3.json,t),p.push(e)}),h.defer(d3.csv,"https://rawgit.com/jlampar/mgr/master/data/choropeth_data.csv"),h.awaitAll(function(e,t){if(e)throw e;var n={},a={},r={},o={},d={};t[t.length-1].forEach(function(e){n[e.woj]=+e.widz,a[e.woj]=+e.wzgwidz,r[e.woj]=+e.area});var h=p.indexOf("2019"),f=topojson.feature(t[h],Object.values(t[h].objects)[0]);p.length=0,u.scale(1).translate([0,0]);var y=d3.geoPath().projection(u).bounds(f),v=.95/Math.max((y[1][0]-y[0][0])/s,(y[1][1]-y[0][1])/l),b=[(s-v*(y[1][0]+y[0][0]))/2,(l-v*(y[1][1]+y[0][1]))/2];u.scale(v).translate(b);for(var B=0;B<t.length-1;B++){o[i.files[B]]=Object.values(t[String(B)].objects)[0].geometries;var I=d3.geoPath().projection(u),w=topojson.feature(t[B],Object.values(t[B].objects)[0]);0===B?c.append("g").attr("id",i.files[B]).selectAll("path").data(w.features).enter().append("path").attr("id",function(e){return e.properties.woj+i.files[B]}).attr("d",I).style("fill",function(e){return m(n[e.properties.woj])}).style("stroke","black").style("stroke-width","0.05em"):c.append("g").attr("id",i.files[B]).attr("class","hide").selectAll("path").data(w.features).enter().append("path").attr("id",function(e){return e.properties.woj+i.files[B]}).attr("d",I)}for(var E in o){for(var k=Object.values(o[E]),x=[],j=0;j<k.length;j++)x.push(o[E][j].properties.Shape_Area);d[E]=x}var M=60,A=M,$=d3.select(document.getElementById("relativeBasket")).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+A+" "+M).attr("id","rSVG"),T=(d3.select("#relativeBasket"),topojson.feature(t[0],Object.values(t[0].objects)[0]));u.scale(1).translate([0,0]);var L=d3.geoPath().projection(u).bounds(T),O=.95/Math.max((L[1][0]-L[0][0])/A,(L[1][1]-L[0][1])/M),P=[(A-O*(L[1][0]+L[0][0]))/2,(M-O*(L[1][1]+L[0][1]))/2];u.scale(O).translate(P);var G=d3.geoPath().projection(u);$.append("g").attr("id","relCont").selectAll("path").data(T.features).enter().append("path").attr("id",function(e){return e.properties.woj}).attr("d",G).style("fill",function(e){return g(a[e.properties.woj])}).style("stroke","black").style("stroke-width","0.01em");for(var H=d3.format(".1f"),D=i.colors.length-1;D>=0;D--){var N="leg"+D;d3.select(document.getElementById("legendBasket")).append("div").style("display","block").attr("id",N);var S=d3.select(document.getElementById(N));S.append("div").text(H(i.breaksRelative[D])).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","right").style("margin-right","1em"),S.append("div").style("background-color",i.colors[D]).style("width","30px").style("height","10px").style("display","inline-block"),S.append("div").text(i.breaksAbsolute[D]).style("display","inline-block").style("width","40px").style("height","10px").style("text-align","left").style("margin-left","1em")}});var f={based:["wojew√≥dztwa","powiaty","gminy"],gene:["500","1000","2000","4000"],net:["256","512"],kernel:["151","81","61","41","21","11","7","5","3","1"]},y=[0,0,0,0];document.getElementById("tdBase").innerHTML=f.based[y[0]],document.getElementById("tdGene").innerHTML=f.gene[y[1]],document.getElementById("tdNet").innerHTML=f.net[y[2]],document.getElementById("tdGauss").innerHTML=f.kernel[y[3]],document.getElementById("nBase").onclick=function(){o(2,0,!0)},document.getElementById("pBase").onclick=function(){o(2,0,!1)},document.getElementById("nGene").onclick=function(){o(3,1,!0)},document.getElementById("pGene").onclick=function(){o(3,1,!1)},document.getElementById("nNet").onclick=function(){o(1,2,!0)},document.getElementById("pNet").onclick=function(){o(1,2,!1)},document.getElementById("nGauss").onclick=function(){o(9,3,!0)},document.getElementById("pGauss").onclick=function(){o(9,3,!1)};var v=$("#cont"),b=$("#header"),B=$("#paraStory"),I=$("#first"),w=$("#second"),E=$("#third");$(window).on("scroll",function(){var e=$(this).scrollTop();v.css({opacity:1-e/200}),b.css({opacity:1-e/130}),B.css({opacity:0+e/350}),I.css({opacity:0+e/450}),w.css({opacity:0+e/470}),E.css({opacity:0+e/490})}),$(window).on("resize",function(){$(window).width()<=961&&(B.css({opacity:"1"}),I.css({opacity:"1"}),w.css({opacity:"1"}),E.css({opacity:"1"}))}),$(".boxFrame").hover(function(){$(window).width()>961&&$(this).children(".icon").toggleClass("icon over")},function(){$(window).width()>961&&$(this).children(".over").toggleClass("over icon")})});
